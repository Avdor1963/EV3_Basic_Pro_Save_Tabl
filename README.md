# EV3_Basic_Pro_Save_Tabl
Модуль Save для создания и использования таблицы рекордов для различных игр (для примера - игра Тетрис)

Идея была в следующем. Создать таблицу __TablRec__ для записи текущих рекордов в виде обычного массива строк в начале модуля при определении публичных глобальных переменных. На каждую строку таблицы отведено по две строки массива строк, при этом при выводе одной строки таблицы TablRec на экран ЖКИ блока EV3 выводим вначале номер строки, а затем первую строку из массива строк (с именем игрока) и сразу же на строку ниже вторую строку из массива строк. Причем на второй строке в текстовом виде в младших 22 символах сформирована запись "дд.мм.гг - сссссссс:ууL", где дд, мм, гг - день месяц и год, то есть дата записи, сссссссс - выровненное вправо значение рекорда, уу - достигнутый в игре уровень. Начиная с 23 позиции и до конца строки в строке масcива строк записан секретный пароль игрока. Так как на экран ЖКИ будет выведено только первые 22 позиции строки, то пароль отображаться не будет. Так как в BasicPro (как и в SmallBasic) нет записей со своей структурой, то приходится целочисленное значение счета рекорда и уровня заносить в соответствующие позиции текстовой строки, преобразуя их в текстовую строку. Зато при выводе на экран не надо делать преобразования.   
  Первым обращением к модулю Save должен быть вызов метода ReadTablRec("Имя файл", "Имя таблицы"). Имя файла задает текстовый файл с расширением (.bpi чтобы его можно было редактировать и загружать/выгружать в Clever), который должен хранить нашу таблицу рекордов. Если такой таблицы нет, то метод создает пустую таблицу и записывает ее в файл с заданным именем на флешпамять блока EV3 в тот же каталог, что и для вызывающей программы. Имя таблицы будут отображаться в верхней строке экрана блока EV3 при просмотре и редактировании таблицы. В самой первой строке файла записывается текущий размер таблицы (TekLen). Чтение из файла с таблицей рекордов происходит только один раз, а вот запись (вернее перезапись всей таблицы) происходит каждый раз, когда таблица рекордов изменяется методами модуля Save.bpm.  
  Для вывода на экран ЖКИ используется метод PrintTablRec(priznak). При этом, если задан priznak = 1, то это означает, что игрок (пользователь) должен выбрать строку таблицы рекордов, по которой будет задан новый текущий игрок. Если же priznak = 0, то редактирование таблицы рекордов и выбор нового игрока запрещен, то есть блокируются нажатия кнопок "L" и "R" и ограничивается реакция на нажатие кнопки "E", то есть можно только просматривать таблицу рекордов, проматывая ее скроллингом вверх или вниз кнопками "U" и "D". Одновременно на одном экране ЖКИ блока EV3 выводяться до 5 строк таблицы рекордов, каждая строка занимает две строки по 22 символа шрифтом №1 (то есть равноширинным с знакоместом 8 х 8 пикселей). В верхней строке ЖКИ в толстой рамке выводится название таблицы. Текущяя строка таблицы отмечается одиночной рамкой вокруг двух строк, отображающих строку таблицы. Строка таблицы с именем текущего игрока отображается символом "▌", после номера строки таблицы. Если текущая строка таблицы совпадает с строкой текущего игрока, то это отображается двойной рамкой.  
  При выборе нового текущего игрока, следует кнопками "U" и "D" выбрать текущую строку таблицы рекордов и нажать кнопку "E". Если выбирается строка с уже введенным ранее именем игрока, то игроку предлагается (методами экранной клавиатуры модуля LCDRu.bpm) ввести пароль, который записан в данной строке. Если пароли сопадают, то выбор считается сделанным и текущая строка таблицы рекордов становится строкой, задающей текущего игрока. Если игрок еще не записан в таблице, то он должен выбрать самую нижнюю строку таблицы рекордов с приглашением "новый игрок". При этом игроку будет предложено ввести свое имя и свой пароль (также методом LCDRu.Klav(strIn, strOut)), кроме того счет рекорда будет зарисан 0, уровень 1 и длина таблицы увеличится на 1 и вся таблица сохранена в  файл. После выбора текущего игрока таблица рекордов будет закрыта и произойдет выход из метода PrintTablRec. При первом выборе текущего игрока метод запросит установить текущую дату, котора потом будет использована при записи новых рекордов.  
  При выборе игрока также разрешено редактирование строк таблицы рекордов. По кнопке "L" - можно отредактировать имя игрока с текущей строки таблицы, записанное в таблице рекордов, а по кнопке "R" - пароль игрока. После редактирования вся таблица целиком сохраняется в файле на флешпамять блока EV3. При этом выбор текущего игрока все равно будет осуществлен только по нажатию на кнопку "E". По этой же кнопке "E" будет завершен просмотр таблицы рекордов, в случае если редактирование было запрещено.   
  При записи нового рекорда в таблицу методом PushTableRec(счет, уровень, признак) проверяется, попадает ли задаваемый счет в рекорды, записанные в таблице. Если попадает, то формируется для текущего игрока новая строка таблицы рекордов. Метод также смещает вниз все строки с меньшим счётом.  При этом проверяется предел записей для одного игрока, то есть с одним именем (MaxRecOne, сейчас равен 5) и если он превышен, то вначале удаляется запись с самым маленьким рекордом текущего игрока, конечно, если он меньше текущего записываемого рекорда. Если общий размер таблицы (MaxLen сейчас пока равный 99)  превышен, то удаляется самый низкий рекорд. В случае успешной записи длина таблицы увеличивается на 1 и вся таблица сохраняется в файле. Метод PushTableRec(...) ничего не выводит на экран ЖКИ, а только устанавливает признак IsRecord = 1  в случае успешной записи в таблицу рекордов и перезадаёт параметры текущего игрока TekCount и TekUroven. Распечатывать таблицу для просмотра должна используюшая модуль Save.bpm программа.  

  
  Использование модуля LCDRu.

1). Скопируйте файл **Save.xml** в директорию, содержащую файлы помощи Clever, например d:\Clever\Help\ru\. Это действие подключит справку по методам модуля Save в окно Cleverа.   
2). В своей программе импортируйте модуль Save (соответсвенно файл Save.bpm должен быть доступен в вашей программе).   
>    import "Save"   

3). Программа TestRun.bp - это пример использования модуля Save - она выводит таблицу рекордов для выбора текущего игрока и при выборе игрока распечатывает его на экране EV3. Потом цикл повторяется, пока не будет нажата кнопка "L".
